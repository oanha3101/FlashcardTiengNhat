<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard N3 - Học Từ Vựng Tiếng Nhật</title> <!-- Tiêu đề rõ ràng hơn -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css"> <!-- Đường dẫn CSS -->
</head>
<body>
   <div class="app-wrapper">
        <div class="glass-container">
            <div class="app-header">
                <h1>日本語 <span>N3 Từ Vựng</span></h1>
                <div class="theme-toggle">
                    <button id="themeToggle" aria-label="Toggle dark mode">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Mode Switcher -->
            <div id="modeSwitcher" class="mode-switcher">
                <a href="index.html" class="mode-btn home-mode" id="goHomeBtn" title="Về trang chủ">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Trang Chủ
                </a>
                <button id="switchToFlashcardSetupBtn" class="mode-btn flashcard-mode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><path d="M3 9h18"></path></svg>
                    Học Flashcard
                </button>
                <button id="switchToWordSetManagerBtn" class="mode-btn wordset-mode active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><path d="M15 2H9a1 1 0 0 0-1 1v2a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1z"></path></svg>
                    Quản lý Bộ Từ
                </button>
                <button id="switchToTestSetupBtn" class="mode-btn test-mode">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></svg>
                    Kiểm Tra
                </button>
            </div>

            <!-- Loading & Error Messages -->
            <div id="loadingMessage" class="message-container loading-message hidden">
                <div class="spinner"></div>
                <p>Đang tải từ vựng...</p>
            </div>
            <div id="errorMessage" class="message-container error-message hidden"></div>

            <!-- Initial Setup Screen -->
            <div id="initialSetup" class="screen range-selector hidden">
                <h2>Chọn khoảng từ để học Flashcard</h2>
                <div class="range-inputs">
                    <div class="input-group">
                        <label for="startWord">Từ số (CSV):</label>
                        <input type="number" id="startWord" value="1" min="1">
                    </div>
                    <div class="input-group">
                        <label for="endWord">Đến số (CSV):</label>
                        <input type="number" id="endWord" value="">
                    </div>
                </div>
                <button id="loadRangeButton" class="primary-btn pulse-btn">Bắt đầu học Flashcard</button>
                <p id="totalWordsMessage" class="info-text"></p>
                <div class="storage-controls">
                    <button id="clearAllMarksButton" class="danger-btn">Xóa tất cả đánh dấu (O/X)</button>
                </div>
            </div>

            <!-- Word Set Manager Screen -->
            <div id="wordSetManager" class="screen">
                <h2>Quản lý Bộ Từ Vựng</h2>
                <div class="create-set-form">
                    <h3>Tạo Bộ Từ Mới</h3>
                    <div class="form-group">
                        <label for="wordSetName">Tên Bộ Từ:</label>
                        <input type="text" id="wordSetName" placeholder="Ví dụ: Bài 1, Từ khó N3">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="wordSetStart">Từ số (CSV):</label>
                            <input type="number" id="wordSetStart" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="wordSetEnd">Đến số (CSV):</label>
                            <input type="number" id="wordSetEnd" value="">
                        </div>
                    </div>
                    <button id="createWordSetButton" class="primary-btn">Tạo Bộ Từ</button>
                    <p id="wordSetTotalMessage" class="info-text"></p>
                </div>

                <div class="search-word-set-container">
                    <label for="searchWordSetInput">Tìm kiếm bộ từ:</label>
                    <input type="text" id="searchWordSetInput" placeholder="Nhập tên bộ từ...">
                </div>
                
                <div id="wordSetListContainer" class="word-set-list-container">
                    <h3>Các Bộ Từ Đã Tạo</h3>
                    <div id="wordSetList" class="word-set-list"></div>
                    <p id="noWordSetsMessage" class="empty-message hidden">Chưa có bộ từ nào được tạo.</p>
                    <p id="noSearchResultsMessage" class="empty-message hidden">Không tìm thấy bộ từ nào.</p>
                </div>
            </div>

            <!-- Word Set Detail View -->
            <div id="wordSetDetailView" class="screen hidden">
                <h2 id="detailViewName" class="set-detail-title"></h2>
                <p id="detailViewRange" class="set-detail-range"></p>
                <div class="action-buttons">
                    <button id="studySetFlashcardButton" class="primary-btn">Học Flashcard Bộ Này</button>
                    <button id="testSetButton" class="secondary-btn">Kiểm Tra Bộ Này</button>
                    <button id="backToSetManagerButton" class="outline-btn">Quay Lại Danh Sách Bộ</button>
                </div>
                <div id="detailWordList" class="word-list-container"></div>
            </div>

            <!-- Flashcard App Screen -->
            <div id="flashcardApp" class="screen hidden">
                <div class="flashcard-header">
                    <h2>Flashcard N3</h2>
                    <div class="progress-stats">
                        <span>Còn lại: <b id="remainingCount">0</b></span>
                        <span>Thẻ: <b id="currentCardNumber">0</b>/<b id="totalInReviewSet">0</b></span>
                        <span>(Tổng bộ: <b id="totalSelectedCount">0</b>)</span>
                    </div>
                </div>
                <div class="flashcard-container" id="flashcardContainer">
                    <div id="markIndicator" class="mark-indicator"></div>
                    <div class="flashcard" id="flashcard">
                        <div class="flashcard-face flashcard-front"><div class="kanji" id="kanjiDisplay"></div></div>
                        <div class="flashcard-face flashcard-back">
                            <div class="hiragana" id="hiraganaDisplay"></div>
                            <div class="meaning" id="meaningDisplay"></div>
                        </div>
                    </div>
                </div>
                <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
                <div class="controls-grid">
                    <button id="flipButton" class="control-btn flip-btn">Lật (Space)</button>
                    <button id="prevButton" class="control-btn prev-btn">Trước (←)</button>
                    <button id="nextButton" class="control-btn next-btn">Tiếp (→)</button>
                    <button id="markKnownButton" class="control-btn known-btn">Thuộc (O)</button>
                    <button id="markUnknownButton" class="control-btn unknown-btn">Chưa thuộc (X)</button>
                    <button id="clearMarkButton" class="control-btn clear-btn">Bỏ dấu</button>
                </div>
                <div class="settings-panel">
                    <div class="setting-group">
                        <label for="reviewModeSelect">Chế độ xem:</label>
                        <select id="reviewModeSelect">
                            <option value="all" selected>Tất cả</option>
                            <option value="unknown">Chưa thuộc (X)</option>
                            <option value="known">Đã thuộc (O)</option>
                            <option value="unmarked">Chưa đánh dấu</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="intervalSelect">Tự động chuyển:</label>
                        <select id="intervalSelect">
                            <option value="3000">3 giây</option>
                            <option value="5000" selected>5 giây</option>
                            <option value="7000">7 giây</option>
                            <option value="10000">10 giây</option>
                            <option value="0">Tắt</option>
                        </select>
                    </div>
                </div>
                <div class="bottom-actions">
                    <button id="restartButton" class="secondary-btn">Học lại / Chọn Bộ Khác</button>
                    <button id="backToWordSetManagerFromFlashcard" class="outline-btn hidden">Về Chi Tiết Bộ Từ</button>
                </div>
            </div>

            <!-- Test Setup Screen -->
            <div id="testSetup" class="screen hidden">
                <h2>Cài Đặt Bài Kiểm Tra</h2>
                <div class="test-setup-form">
                    <div class="form-group">
                        <label for="numTestQuestions">Số câu hỏi:</label>
                        <input type="number" id="numTestQuestions" value="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="testType">Loại câu hỏi:</label>
                        <select id="testType">
                            <option value="viToJp">Nghĩa Tiếng Việt → Từ Tiếng Nhật</option>
                            <option value="jpToVi">Từ Tiếng Nhật → Nghĩa Tiếng Việt</option>
                              <option value="aiFillInTheBlank">Trắc nghiệm AI (Điền từ)</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="testStartWord">Từ vựng từ số (CSV):</label>
                            <input type="number" id="testStartWord" value="1" min="1">
                        </div>
                        <div class="form-group">
                            <label for="testEndWord">Đến số (CSV):</label>
                            <input type="number" id="testEndWord" value="">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="testSpeedMode">Chế độ thời gian:</label>
                        <select id="testSpeedMode" class="form-control">
                            <option value="unlimited" selected>Không giới hạn</option>
                            <option value="fast">Nhanh (5 giây/câu)</option>
                            <option value="normal">Bình thường (15 giây/câu)</option>
                            <option value="slow">Chậm (30 giây/câu)</option>
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button id="startTestButton" class="primary-btn">Bắt đầu Kiểm tra</button>
                        <button id="backToWordSetManagerFromTestSetup" class="outline-btn hidden">Về Quản lý Bộ Từ</button>
                    </div>
                </div>
            </div>

            <!-- Test Interface Screen -->
            <div id="testInterface" class="screen hidden test-mode-interface">
                <h2>Bài Kiểm Tra Từ Vựng</h2>
                <div class="test-timer-display">
                    Thời gian còn lại: <span id="timeLeftDisplay">--:--</span>
                </div>
                <div class="test-content-area">
                    <div class="test-main-panel">
                        <div class="test-question-header">
                            <span>Câu <span id="currentQuestionNum">1</span>/<span id="totalTestQuestions">0</span></span>
                        </div>
                        <div id="questionText" class="question-text-display"></div>
                        <div id="optionsArea" class="options-grid"></div>
                        <div class="test-navigation">
                            <button id="prevTestQuestionButton" class="action-btn"><- Câu Trước</button>
                            <button id="nextTestQuestionButton" class="action-btn">Câu Tiếp -></button>
                        </div>
                        <button id="finishTestButton" class="action-btn primary-btn">Nộp Bài</button>
                    </div>
                    <div id="testQuestionNavigator" class="test-question-navigator">
                        <h4>Danh sách câu hỏi</h4>
                        <div id="testQuestionList" class="test-question-list"></div>
                    </div>
                </div>
            </div>

         <!-- Test Results Screen (ĐÃ CẬP NHẬT - KHÔNG CHIA CỘT) -->
<div id="testResults" class="screen hidden">
    <h2>Kết Quả Kiểm Tra</h2>
    <div class="results-summary">
        <div class="score-display">
            <div class="score-circle" style="--score-percent: 0%;">
                <span id="scorePercentage">0</span>
            </div>
            <p>Điểm của bạn: <span id="scoreCorrect">0</span>/<span id="scoreTotal">0</span></p>
        </div>
    </div>
    <div id="reviewAnswersArea" class="review-answers"> <!-- Giữ nguyên container chung -->
        <h4>Xem lại câu trả lời:</h4>
        <div id="allAnswersList" class="answer-list single-column-list"> <!-- Một danh sách duy nhất -->
            <!-- JS sẽ điền các câu trả lời vào đây -->
            <!-- Ví dụ một item (JS sẽ tạo):
            <div class="review-answer-item">
                <p class="question-review-text">1. Câu hỏi: "Từ nào có nghĩa là 'xin chào'?"</p>
                <p class="user-answer-text">Bạn chọn: <span class="user-choice-correct">こんにちは</span></p>
                <p class="correct-answer-text">Đáp án đúng: こんにちは</p> // Có thể ẩn nếu bạn chọn đúng
            </div>
            <div class="review-answer-item">
                <p class="question-review-text">2. Câu hỏi: "Từ nào có nghĩa là 'cảm ơn'?"</p>
                <p class="user-answer-text">Bạn chọn: <span class="user-choice-incorrect">おはよう</span></p>
                <p class="correct-answer-text">Đáp án đúng: ありがとう</p>
            </div>
            <div class="review-answer-item">
                <p class="question-review-text">3. Câu hỏi: "Từ nào có nghĩa là 'tạm biệt'?"</p>
                <p class="user-answer-text">Bạn chọn: <span class="user-choice-unanswered">Chưa trả lời</span></p>
                <p class="correct-answer-text">Đáp án đúng: さようなら</p>
            </div>
            -->
        </div>
    </div>
    <div class="results-actions">
        <button id="retakeTestButton" class="primary-btn">Làm lại Bài Kiểm Tra</button>
        <button id="backToTestSetupButton" class="secondary-btn">Cài đặt Lại Test</button>
        <button id="backToFlashcardFromResultsButton" class="outline-btn">Về Quản Lý Bộ Từ</button>
    </div>
</div>

            <div class="app-footer">
                <p>© 2025 Japanese N3 Vocab App</p>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="wordFullscreenModal" class="word-fullscreen-modal hidden">
        <div id="wordFullscreenContent" class="word-fullscreen-content">
            <button id="wordFullscreenCloseBtn" class="word-fullscreen-close-btn" aria-label="Close">×</button>
            <div id="wordFullscreenKanji" class="word-fullscreen-kanji"></div>
            <div id="wordFullscreenHiragana" class="word-fullscreen-hiragana"></div>
            <div id="wordFullscreenMeaning" class="word-fullscreen-meaning"></div>
        </div>
    </div>

    <script src="../js/n3_vocab_data.js"></script>
    <script src="../js/vocab.js"></script> <!-- Đảm bảo tên file JS chính xác -->

</body>
</html>